using System;

namespace FractalDataWorks.Collections.Attributes;

/// <summary>
/// Marks a property for which to generate lookup methods.
/// </summary>
[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]
public sealed class TypeLookupAttribute : Attribute
{
    /// <summary>
    /// Initializes a new instance of the <see cref="TypeLookupAttribute"/> class.
    /// </summary>
    /// <param name="methodName">Required method name for the lookup (e.g. "Name", "Id", "Category").</param>
    /// <param name="allowMultiple">Allow multiple results per lookup key.</param>
    /// <param name="returnType">The return type for this specific lookup method.</param>
    public TypeLookupAttribute(
        string methodName,
        bool allowMultiple = false,
        Type? returnType = null)
    {
        MethodName = methodName ?? throw new ArgumentNullException(nameof(methodName));
        AllowMultiple = allowMultiple;
        ReturnType = returnType;
    }

    /// <summary>
    /// Gets the method name for the lookup (e.g. "Name", "Id", "Category").
    /// </summary>
    public string MethodName { get; }

    /// <summary>
    /// Gets whether to allow multiple results per lookup key.
    /// </summary>
    public bool AllowMultiple { get; }

    /// <summary>
    /// Gets the return type for this specific lookup method.
    /// If not specified, inherits from the TypeCollection attribute ReturnType or auto-detected type.
    /// </summary>
    public Type? ReturnType { get; }
}